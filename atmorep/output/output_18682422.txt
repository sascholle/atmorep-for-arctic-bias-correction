0: Wandb run: atmorep-ucz8xe7v-18682422
0: l50157:2415095:2415095 [0] NCCL INFO Bootstrap : Using ib0:10.128.11.200<0>
0: l50157:2415095:2415095 [0] NCCL INFO NET/Plugin: No plugin found (libnccl-net.so)
0: l50157:2415095:2415095 [0] NCCL INFO NET/Plugin: Plugin load returned 2 : libnccl-net.so: cannot open shared object file: No such file or directory : when loading libnccl-net.so
0: l50157:2415095:2415095 [0] NCCL INFO NET/Plugin: Using internal network plugin.
0: l50157:2415095:2415095 [0] NCCL INFO cudaDriverVersion 12060
0: NCCL version 2.21.5+cuda12.4
0: l50157:2415095:2415606 [0] NCCL INFO NET/IB : Using [0]mlx5_0:1/IB [1]mlx5_1:1/IB [RO]; OOB ib0:10.128.11.200<0>
0: l50157:2415095:2415606 [0] NCCL INFO Using non-device net plugin version 0
0: l50157:2415095:2415606 [0] NCCL INFO Using network IB
0: l50157:2415095:2415606 [0] NCCL INFO DMA-BUF is available on GPU device 0
0: l50157:2415095:2415606 [0] NCCL INFO ncclCommInitRank comm 0x55555f102090 rank 0 nranks 1 cudaDev 0 nvmlDev 0 busId 3000 commId 0xb8b04306653aa7b4 - Init START
0: l50157:2415095:2415606 [0] NCCL INFO Setting affinity for GPU 0 to ffff0000,00000000,00000000,00000000,ffff0000,00000000
0: l50157:2415095:2415606 [0] NCCL INFO comm 0x55555f102090 rank 0 nRanks 1 nNodes 1 localRanks 1 localRank 0 MNNVL 0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 00/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 01/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 02/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 03/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 04/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 05/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 06/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 07/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 08/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 09/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 10/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 11/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 12/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 13/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 14/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 15/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 16/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 17/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 18/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 19/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 20/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 21/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 22/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 23/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 24/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 25/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 26/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 27/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 28/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 29/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 30/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Channel 31/32 :    0
0: l50157:2415095:2415606 [0] NCCL INFO Trees [0] -1/-1/-1->0->-1 [1] -1/-1/-1->0->-1 [2] -1/-1/-1->0->-1 [3] -1/-1/-1->0->-1 [4] -1/-1/-1->0->-1 [5] -1/-1/-1->0->-1 [6] -1/-1/-1->0->-1 [7] -1/-1/-1->0->-1 [8] -1/-1/-1->0->-1 [9] -1/-1/-1->0->-1 [10] -1/-1/-1->0->-1 [11] -1/-1/-1->0->-1 [12] -1/-1/-1->0->-1 [13] -1/-1/-1->0->-1 [14] -1/-1/-1->0->-1 [15] -1/-1/-1->0->-1 [16] -1/-1/-1->0->-1 [17] -1/-1/-1->0->-1 [18] -1/-1/-1->0->-1 [19] -1/-1/-1->0->-1 [20] -1/-1/-1->0->-1 [21] -1/-1/-1->0->-1 [22] -1/-1/-1->0->-1 [23] -1/-1/-1->0->-1 [24] -1/-1/-1->0->-1 [25] -1/-1/-1->0->-1 [26] -1/-1/-1->0->-1 [27] -1/-1/-1->0->-1 [28] -1/-1/-1->0->-1 [29] -1/-1/-1->0->-1 [30] -1/-1/-1->0->-1 [31] -1/-1/-1->0->-1
0: l50157:2415095:2415606 [0] NCCL INFO P2P Chunksize set to 131072
0: l50157:2415095:2415606 [0] NCCL INFO Connected all rings
0: l50157:2415095:2415606 [0] NCCL INFO Connected all trees
0: l50157:2415095:2415606 [0] NCCL INFO 32 coll channels, 32 collnet channels, 0 nvls channels, 32 p2p channels, 32 p2p channels per peer
0: l50157:2415095:2415606 [0] NCCL INFO TUNER/Plugin: Plugin load returned 11 : libnccl-net.so: cannot open shared object file: No such file or directory : when loading libnccl-tuner.so
0: l50157:2415095:2415606 [0] NCCL INFO TUNER/Plugin: Using internal tuner plugin.
0: l50157:2415095:2415606 [0] NCCL INFO ncclCommInitRank comm 0x55555f102090 rank 0 nranks 1 cudaDev 0 nvmlDev 0 busId 3000 commId 0xb8b04306653aa7b4 - Init COMPLETE
0: Running Evaluate.evaluate with mode = forecast
0: Available keys in the Zarr dataset: ['data', 'data_sfc', 'lats', 'lons', 'time']
0: self.ds['data'] : (105192, 7, 5, 721, 1440) :: (105192,)
0: self.lats : (721,)
0: self.lons : (1440,)
0: Available keys in the Zarr dataset: ['data', 'data_sfc', 'lats', 'lons', 'time']
0: self.ds['data'] : (105192, 7, 5, 721, 1440) :: (105192,)
0: self.lats : (721,)
0: self.lons : (1440,)
0: ['cuda:0', 'cuda:1', 'cuda:2', 'cuda:3'] 0
0: ['cuda:0', 'cuda:1', 'cuda:2', 'cuda:3'] 0
0: ['cuda:0', 'cuda:1', 'cuda:2', 'cuda:3'] 0
0: ['cuda:0', 'cuda:1', 'cuda:2', 'cuda:3'] 0
0: ['cuda:0', 'cuda:1', 'cuda:2', 'cuda:3'] 0
0: ['cuda:0', 'cuda:1', 'cuda:2', 'cuda:3'] 0
0: ['cuda:0', 'cuda:1', 'cuda:2', 'cuda:3'] 0
0: Loaded model id = hjbmsjft.
0: with_ddp : True
0: num_accs_per_task : 4
0: par_rank : 0
0: par_size : 1
0: fields : [['velocity_u', [1, 1024, ['velocity_v', 'temperature'], 0, ['j8dwr5qj', -2]], [96, 105, 114, 123, 137], [12, 3, 6], [3, 18, 18], [0.5, 0.9, 0.2, 0.05]], ['velocity_v', [1, 1024, ['velocity_u', 'temperature'], 0, ['0tlnm5up', -2]], [96, 105, 114, 123, 137], [12, 3, 6], [3, 18, 18], [0.5, 0.9, 0.2, 0.05]], ['specific_humidity', [1, 1024, ['velocity_u', 'velocity_v', 'temperature'], 0, ['v63l01zu', -2]], [96, 105, 114, 123, 137], [12, 3, 6], [3, 18, 18], [0.5, 0.9, 0.2, 0.05]], ['velocity_z', [1, 1024, ['velocity_u', 'velocity_v', 'temperature'], 0, ['9l1errbo', -2]], [96, 105, 114, 123, 137], [12, 3, 6], [3, 18, 18], [0.5, 0.9, 0.2, 0.05]], ['temperature', [1, 1024, ['velocity_u', 'velocity_v', 'specific_humidity'], 0, ['7ojls62c', -2]], [96, 105, 114, 123, 137], [12, 2, 4], [3, 27, 27], [0.5, 0.9, 0.2, 0.05], 'Local'], ['total_precip', [1, 1024, ['velocity_u', 'velocity_v', 'velocity_z', 'specific_humidity'], 0], [0], [12, 6, 12], [3, 9, 9], [0.25, 0.9, 0.1, 0.05]], ['t2m', [1, 1024, ['velocity_u', '
0: velocity_v', 'velocity_z', 'specific_humidity'], 0], [0], [12, 2, 4], [3, 27, 27], [0.5, 0.9, 0.2, 0.05], 'Local']]
0: fields_prediction : [['velocity_u', 0.125], ['velocity_v', 0.125], ['specific_humidity', 0.05], ['velocity_z', 0.01], ['temperature', 0.1], ['total_precip', 0.01], ['t2m', 0.58]]
0: fields_targets : []
0: years_train : [2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020]
0: years_val : [2021]
0: month : None
0: geo_range_sampling : [[0.0, 360.0], [0.0, 360.0]]
0: time_sampling : 1
0: torch_seed : 5521420987310380410
0: batch_size_validation : 1
0: batch_size : 96
0: num_epochs : 128
0: num_samples_per_epoch : 480
0: num_samples_validate : 128
0: num_loader_workers : 5
0: size_token_info : 8
0: size_token_info_net : 16
0: grad_checkpointing : True
0: with_cls : False
0: with_mixed_precision : True
0: with_layernorm : True
0: coupling_num_heads_per_field : 1
0: dropout_rate : 0.05
0: with_qk_lnorm : True
0: encoder_num_layers : 6
0: encoder_num_heads : 16
0: encoder_num_mlp_layers : 2
0: encoder_att_type : dense
0: decoder_num_layers : 6
0: decoder_num_heads : 16
0: decoder_num_mlp_layers : 2
0: decoder_self_att : False
0: decoder_cross_att_ratio : 0.5
0: decoder_cross_att_rate : 1.0
0: decoder_att_type : dense
0: net_tail_num_nets : 16
0: net_tail_num_layers : 0
0: losses : ['mse_ensemble', 'stats']
0: optimizer_zero : False
0: lr_start : 1e-05
0: lr_max : 2e-05
0: lr_min : 1e-05
0: weight_decay : 0.025
0: lr_decay_rate : 1.025
0: lr_start_epochs : 3
0: model_log_frequency : 256
0: BERT_strategy : forecast
0: forecast_num_tokens : 2
0: BERT_fields_synced : False
0: BERT_mr_max : 2
0: log_test_num_ranks : 4
0: save_grads : False
0: profile : False
0: test_initial : False
0: attention : False
0: rng_seed : None
0: with_wandb : True
0: slurm_job_id : 18682422
0: wandb_id : ucz8xe7v
0: file_path : /work/ab1412/atmorep/data/era5_y2010_2020_res25_with_t2m.zarr
0: n_size : [36, 13.5, 27.0]
0: model_id : hjbmsjft
0: with_pytest : True
0: lat_sampling_weighted : False
0: it == 0 and starting val norms printouts
0: [DEBUG] PREDICTIONS VALIDATION BATCH
0: Normalised validation prediction values for 't2m' with shape: torch.Size([16, 2187])
0:          min = -0.962, max = 1.606, mean = 0.262
0:          sample (first 20): tensor([-0.0575, -0.1177, -0.0930, -0.0835, -0.0869, -0.1290, -0.1796, -0.1893, -0.1923, -0.1072, -0.0864, -0.1163,
0:         -0.1150, -0.2071, -0.1611, -0.0848, -0.1207, -0.0945, -0.1261, -0.2770])
0: validation loss for strategy=forecast at epoch 0 : 0.2537802457809448
0: validation loss for velocity_u : 0.03379958122968674
0: validation loss for velocity_v : 0.06425733119249344
0: validation loss for specific_humidity : 0.022267339751124382
0: validation loss for velocity_z : 0.43917855620384216
0: validation loss for temperature : 0.06270623952150345
0: validation loss for total_precip : 0.6102620959281921
0: validation loss for t2m : 0.5439907312393188
0: ============================= test session starts ==============================
0: platform linux -- Python 3.10.10, pytest-8.3.4, pluggy-1.5.0
0: rootdir: /work/ab1412
0: collected 3 items
0: 
0: atmorep/tests/validation_test.py Sample 76, Level 96: Timestamp 2021-05-22 15:00:00, Shape (54, 108)
0: Sample 71, Level 96: Timestamp 2021-08-03 11:00:00, Shape (54, 108)
0: Sample 28, Level 96: Timestamp 2021-02-12 11:00:00, Shape (54, 108)
0: Sample 69, Level 96: Timestamp 2021-11-04 14:00:00, Shape (54, 108)
0: Sample 75, Level 96: Timestamp 2021-01-02 15:00:00, Shape (54, 108)
0: .Field: velocity_u, levels: [ 96 105 114 123 137], level: 96, level_idx: 0, samples: [28, 31, 103, 35, 39, 59, 71, 121, 52, 32, 117, 82, 29, 104, 97, 67, 45, 112, 1, 56, 63, 122, 64, 19, 23, 22, 53, 65, 74, 69, 108, 21, 123, 34, 18, 79, 2, 86, 6, 107, 96, 14, 27, 111, 89, 48, 99, 125, 41, 13]
0: Field: velocity_u, levels: [ 96 105 114 123 137], level: 105, level_idx: 1, samples: [28, 31, 103, 35, 39, 59, 71, 121, 52, 32, 117, 82, 29, 104, 97, 67, 45, 112, 1, 56, 63, 122, 64, 19, 23, 22, 53, 65, 74, 69, 108, 21, 123, 34, 18, 79, 2, 86, 6, 107, 96, 14, 27, 111, 89, 48, 99, 125, 41, 13]
0: Field: velocity_u, levels: [ 96 105 114 123 137], level: 114, level_idx: 2, samples: [28, 31, 103, 35, 39, 59, 71, 121, 52, 32, 117, 82, 29, 104, 97, 67, 45, 112, 1, 56, 63, 122, 64, 19, 23, 22, 53, 65, 74, 69, 108, 21, 123, 34, 18, 79, 2, 86, 6, 107, 96, 14, 27, 111, 89, 48, 99, 125, 41, 13]
0: Field: velocity_u, levels: [ 96 105 114 123 137], level: 123, level_idx: 3, samples: [28, 31, 103, 35, 39, 59, 71, 121, 52, 32, 117, 82, 29, 104, 97, 67, 45, 112, 1, 56, 63, 122, 64, 19, 23, 22, 53, 65, 74, 69, 108, 21, 123, 34, 18, 79, 2, 86, 6, 107, 96, 14, 27, 111, 89, 48, 99, 125, 41, 13]
0: Field: velocity_u, levels: [ 96 105 114 123 137], level: 137, level_idx: 4, samples: [28, 31, 103, 35, 39, 59, 71, 121, 52, 32, 117, 82, 29, 104, 97, 67, 45, 112, 1, 56, 63, 122, 64, 19, 23, 22, 53, 65, 74, 69, 108, 21, 123, 34, 18, 79, 2, 86, 6, 107, 96, 14, 27, 111, 89, 48, 99, 125, 41, 13]
0: ..
0: 
0: ============================== 3 passed in 13.84s ==============================
0: ============================= test session starts ==============================
0: platform linux -- Python 3.10.10, pytest-8.3.4, pluggy-1.5.0
0: rootdir: /work/ab1412
0: collected 3 items
0: 
0: atmorep/tests/validation_test.py Sample 33, Level 96: Timestamp 2021-10-05 20:00:00, Shape (54, 108)
0: Sample 26, Level 96: Timestamp 2021-05-19 02:00:00, Shape (54, 108)
0: Sample 18, Level 96: Timestamp 2021-04-14 02:00:00, Shape (54, 108)
0: Sample 27, Level 96: Timestamp 2021-04-24 16:00:00, Shape (54, 108)
0: Sample 92, Level 96: Timestamp 2021-03-05 08:00:00, Shape (54, 108)
0: .Field: velocity_v, levels: [ 96 105 114 123 137], level: 96, level_idx: 0, samples: [111, 49, 73, 84, 36, 45, 17, 86, 114, 58, 116, 112, 28, 102, 89, 100, 72, 54, 4, 16, 77, 11, 15, 88, 113, 22, 47, 108, 104, 106, 35, 87, 101, 98, 66, 125, 63, 103, 19, 5, 127, 38, 81, 122, 90, 126, 74, 94, 3, 44]
0: Field: velocity_v, levels: [ 96 105 114 123 137], level: 105, level_idx: 1, samples: [111, 49, 73, 84, 36, 45, 17, 86, 114, 58, 116, 112, 28, 102, 89, 100, 72, 54, 4, 16, 77, 11, 15, 88, 113, 22, 47, 108, 104, 106, 35, 87, 101, 98, 66, 125, 63, 103, 19, 5, 127, 38, 81, 122, 90, 126, 74, 94, 3, 44]
0: Field: velocity_v, levels: [ 96 105 114 123 137], level: 114, level_idx: 2, samples: [111, 49, 73, 84, 36, 45, 17, 86, 114, 58, 116, 112, 28, 102, 89, 100, 72, 54, 4, 16, 77, 11, 15, 88, 113, 22, 47, 108, 104, 106, 35, 87, 101, 98, 66, 125, 63, 103, 19, 5, 127, 38, 81, 122, 90, 126, 74, 94, 3, 44]
0: Field: velocity_v, levels: [ 96 105 114 123 137], level: 123, level_idx: 3, samples: [111, 49, 73, 84, 36, 45, 17, 86, 114, 58, 116, 112, 28, 102, 89, 100, 72, 54, 4, 16, 77, 11, 15, 88, 113, 22, 47, 108, 104, 106, 35, 87, 101, 98, 66, 125, 63, 103, 19, 5, 127, 38, 81, 122, 90, 126, 74, 94, 3, 44]
0: Field: velocity_v, levels: [ 96 105 114 123 137], level: 137, level_idx: 4, samples: [111, 49, 73, 84, 36, 45, 17, 86, 114, 58, 116, 112, 28, 102, 89, 100, 72, 54, 4, 16, 77, 11, 15, 88, 113, 22, 47, 108, 104, 106, 35, 87, 101, 98, 66, 125, 63, 103, 19, 5, 127, 38, 81, 122, 90, 126, 74, 94, 3, 44]
0: ..
0: 
0: ============================== 3 passed in 3.44s ===============================
0: ============================= test session starts ==============================
0: platform linux -- Python 3.10.10, pytest-8.3.4, pluggy-1.5.0
0: rootdir: /work/ab1412
0: collected 3 items
0: 
0: atmorep/tests/validation_test.py Sample 89, Level 96: Timestamp 2021-07-09 18:00:00, Shape (54, 108)
0: Sample 100, Level 96: Timestamp 2021-12-22 10:00:00, Shape (54, 108)
0: Sample 26, Level 96: Timestamp 2021-05-19 02:00:00, Shape (54, 108)
0: Sample 62, Level 96: Timestamp 2021-01-10 18:00:00, Shape (54, 108)
0: Sample 35, Level 96: Timestamp 2021-10-12 05:00:00, Shape (54, 108)
0: .Field: specific_humidity, levels: [ 96 105 114 123 137], level: 96, level_idx: 0, samples: [66, 18, 77, 54, 88, 37, 8, 100, 9, 92, 36, 39, 48, 97, 21, 5, 114, 76, 58, 120, 57, 102, 49, 68, 45, 60, 80, 2, 27, 51, 1, 40, 81, 85, 59, 118, 124, 50, 12, 61, 22, 65, 122, 24, 55, 16, 98, 111, 75, 106]
0: Field: specific_humidity, levels: [ 96 105 114 123 137], level: 105, level_idx: 1, samples: [66, 18, 77, 54, 88, 37, 8, 100, 9, 92, 36, 39, 48, 97, 21, 5, 114, 76, 58, 120, 57, 102, 49, 68, 45, 60, 80, 2, 27, 51, 1, 40, 81, 85, 59, 118, 124, 50, 12, 61, 22, 65, 122, 24, 55, 16, 98, 111, 75, 106]
0: Field: specific_humidity, levels: [ 96 105 114 123 137], level: 114, level_idx: 2, samples: [66, 18, 77, 54, 88, 37, 8, 100, 9, 92, 36, 39, 48, 97, 21, 5, 114, 76, 58, 120, 57, 102, 49, 68, 45, 60, 80, 2, 27, 51, 1, 40, 81, 85, 59, 118, 124, 50, 12, 61, 22, 65, 122, 24, 55, 16, 98, 111, 75, 106]
0: Field: specific_humidity, levels: [ 96 105 114 123 137], level: 123, level_idx: 3, samples: [66, 18, 77, 54, 88, 37, 8, 100, 9, 92, 36, 39, 48, 97, 21, 5, 114, 76, 58, 120, 57, 102, 49, 68, 45, 60, 80, 2, 27, 51, 1, 40, 81, 85, 59, 118, 124, 50, 12, 61, 22, 65, 122, 24, 55, 16, 98, 111, 75, 106]
0: Field: specific_humidity, levels: [ 96 105 114 123 137], level: 137, level_idx: 4, samples: [66, 18, 77, 54, 88, 37, 8, 100, 9, 92, 36, 39, 48, 97, 21, 5, 114, 76, 58, 120, 57, 102, 49, 68, 45, 60, 80, 2, 27, 51, 1, 40, 81, 85, 59, 118, 124, 50, 12, 61, 22, 65, 122, 24, 55, 16, 98, 111, 75, 106]
0: ..
0: 
0: ============================== 3 passed in 2.43s ===============================
0: ============================= test session starts ==============================
0: platform linux -- Python 3.10.10, pytest-8.3.4, pluggy-1.5.0
0: rootdir: /work/ab1412
0: collected 3 items
0: 
0: atmorep/tests/validation_test.py Sample 108, Level 96: Timestamp 2021-04-18 15:00:00, Shape (54, 108)
0: Sample 58, Level 96: Timestamp 2021-08-11 06:00:00, Shape (54, 108)
0: Sample 1, Level 96: Timestamp 2021-01-24 10:00:00, Shape (54, 108)
0: Sample 22, Level 96: Timestamp 2021-08-28 20:00:00, Shape (54, 108)
0: Sample 44, Level 96: Timestamp 2021-07-23 14:00:00, Shape (54, 108)
0: .Field: velocity_z, levels: [ 96 105 114 123 137], level: 96, level_idx: 0, samples: [23, 62, 80, 29, 45, 93, 37, 36, 124, 85, 84, 108, 1, 72, 71, 4, 0, 67, 8, 107, 51, 89, 119, 63, 65, 125, 17, 123, 46, 30, 90, 81, 86, 73, 99, 112, 96, 66, 70, 15, 92, 44, 91, 12, 77, 61, 32, 121, 106, 47]
0: Field: velocity_z, levels: [ 96 105 114 123 137], level: 105, level_idx: 1, samples: [23, 62, 80, 29, 45, 93, 37, 36, 124, 85, 84, 108, 1, 72, 71, 4, 0, 67, 8, 107, 51, 89, 119, 63, 65, 125, 17, 123, 46, 30, 90, 81, 86, 73, 99, 112, 96, 66, 70, 15, 92, 44, 91, 12, 77, 61, 32, 121, 106, 47]
0: Field: velocity_z, levels: [ 96 105 114 123 137], level: 114, level_idx: 2, samples: [23, 62, 80, 29, 45, 93, 37, 36, 124, 85, 84, 108, 1, 72, 71, 4, 0, 67, 8, 107, 51, 89, 119, 63, 65, 125, 17, 123, 46, 30, 90, 81, 86, 73, 99, 112, 96, 66, 70, 15, 92, 44, 91, 12, 77, 61, 32, 121, 106, 47]
0: Field: velocity_z, levels: [ 96 105 114 123 137], level: 123, level_idx: 3, samples: [23, 62, 80, 29, 45, 93, 37, 36, 124, 85, 84, 108, 1, 72, 71, 4, 0, 67, 8, 107, 51, 89, 119, 63, 65, 125, 17, 123, 46, 30, 90, 81, 86, 73, 99, 112, 96, 66, 70, 15, 92, 44, 91, 12, 77, 61, 32, 121, 106, 47]
0: Field: velocity_z, levels: [ 96 105 114 123 137], level: 137, level_idx: 4, samples: [23, 62, 80, 29, 45, 93, 37, 36, 124, 85, 84, 108, 1, 72, 71, 4, 0, 67, 8, 107, 51, 89, 119, 63, 65, 125, 17, 123, 46, 30, 90, 81, 86, 73, 99, 112, 96, 66, 70, 15, 92, 44, 91, 12, 77, 61, 32, 121, 106, 47]
0: ..
0: 
0: ============================== 3 passed in 2.45s ===============================
0: ============================= test session starts ==============================
0: platform linux -- Python 3.10.10, pytest-8.3.4, pluggy-1.5.0
0: rootdir: /work/ab1412
0: collected 3 items
0: 
0: atmorep/tests/validation_test.py Sample 63, Level 96: Timestamp 2021-07-24 21:00:00, Shape (54, 108)
0: Sample 79, Level 96: Timestamp 2021-04-19 09:00:00, Shape (54, 108)
0: Sample 72, Level 96: Timestamp 2021-09-20 06:00:00, Shape (54, 108)
0: Sample 1, Level 96: Timestamp 2021-01-24 10:00:00, Shape (54, 108)
0: Sample 22, Level 96: Timestamp 2021-08-28 20:00:00, Shape (54, 108)
0: .Field: temperature, levels: [ 96 105 114 123 137], level: 96, level_idx: 0, samples: [112, 91, 87, 75, 126, 41, 116, 94, 120, 50, 105, 28, 99, 33, 51, 5, 69, 122, 90, 13, 123, 23, 15, 0, 2, 3, 32, 44, 76, 86, 14, 84, 1, 10, 114, 117, 54, 46, 79, 55, 60, 21, 97, 38, 100, 34, 49, 78, 56, 71]
0: Field: temperature, levels: [ 96 105 114 123 137], level: 105, level_idx: 1, samples: [112, 91, 87, 75, 126, 41, 116, 94, 120, 50, 105, 28, 99, 33, 51, 5, 69, 122, 90, 13, 123, 23, 15, 0, 2, 3, 32, 44, 76, 86, 14, 84, 1, 10, 114, 117, 54, 46, 79, 55, 60, 21, 97, 38, 100, 34, 49, 78, 56, 71]
0: Field: temperature, levels: [ 96 105 114 123 137], level: 114, level_idx: 2, samples: [112, 91, 87, 75, 126, 41, 116, 94, 120, 50, 105, 28, 99, 33, 51, 5, 69, 122, 90, 13, 123, 23, 15, 0, 2, 3, 32, 44, 76, 86, 14, 84, 1, 10, 114, 117, 54, 46, 79, 55, 60, 21, 97, 38, 100, 34, 49, 78, 56, 71]
0: Field: temperature, levels: [ 96 105 114 123 137], level: 123, level_idx: 3, samples: [112, 91, 87, 75, 126, 41, 116, 94, 120, 50, 105, 28, 99, 33, 51, 5, 69, 122, 90, 13, 123, 23, 15, 0, 2, 3, 32, 44, 76, 86, 14, 84, 1, 10, 114, 117, 54, 46, 79, 55, 60, 21, 97, 38, 100, 34, 49, 78, 56, 71]
0: Field: temperature, levels: [ 96 105 114 123 137], level: 137, level_idx: 4, samples: [112, 91, 87, 75, 126, 41, 116, 94, 120, 50, 105, 28, 99, 33, 51, 5, 69, 122, 90, 13, 123, 23, 15, 0, 2, 3, 32, 44, 76, 86, 14, 84, 1, 10, 114, 117, 54, 46, 79, 55, 60, 21, 97, 38, 100, 34, 49, 78, 56, 71]
0: ..
0: 
0: ============================== 3 passed in 2.14s ===============================
0: ============================= test session starts ==============================
0: platform linux -- Python 3.10.10, pytest-8.3.4, pluggy-1.5.0
0: rootdir: /work/ab1412
0: collected 3 items
0: 
0: atmorep/tests/validation_test.py Sample 81, Level 96: Timestamp 2021-11-05 08:00:00, Shape (54, 108)
0: Sample 117, Level 96: Timestamp 2021-12-21 05:00:00, Shape (54, 108)
0: Sample 123, Level 96: Timestamp 2021-02-20 02:00:00, Shape (54, 108)
0: Sample 111, Level 96: Timestamp 2021-06-16 03:00:00, Shape (54, 108)
0: Sample 12, Level 96: Timestamp 2021-07-31 00:00:00, Shape (54, 108)
0: .Field: total_precip, levels: [0], level: 0, level_idx: 0, samples: [11, 114, 119, 43, 121, 105, 123, 75, 102, 6, 13, 74, 12, 99, 60, 83, 37, 30, 65, 14, 31, 46, 78, 77, 38, 86, 18, 39, 47, 15, 106, 68, 113, 41, 48, 40, 70, 66, 88, 82, 122, 116, 56, 61, 96, 108, 33, 87, 81, 72]
0: .F
0: 
0: =================================== FAILURES ===================================
0: __________________________________ test_rmse ___________________________________
0: 
0: field = 'total_precip', model_id = 'ucz8xe7v', BERT = False, epoch = 0
0: 
0:     def test_rmse(field, model_id, BERT, epoch = 0):
0:         """
0:         Test that for each field the RMSE does not exceed a certain value.
0:         50 random samples.
0:         """
0:         store_t = zarr.ZipStore(atmorep_target().format(model_id, model_id, str(epoch).zfill(5)))
0:         target = zarr.group(store_t)
0:     
0:         store_p = zarr.ZipStore(atmorep_pred().format(model_id, model_id, str(epoch).zfill(5)))
0:         pred = zarr.group(store_p)
0:     
0:         nsamples = min(len(target[field]), 50)
0:         samples = rnd.sample(range(len(target[field])), nsamples)
0:         levels = [int(f.split("=")[1]) for f in target[f"{field}/sample=00000"]] if BERT else target[f"{field}/sample=00000"].ml[:]
0:     
0:         get_data = get_BERT if BERT else get_forecast
0:     
0:         for level in levels:
0:             level_idx = level if BERT else np.where(levels == level)[0].tolist()[0]
0:             for s in samples:
0: >               sample_target, _, _, _ = get_data(target,field, s, level_idx)
0: 
0: atmorep/tests/validation_test.py:208: 
0: _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
0: atmorep/tests/test_utils.py:37: in get_forecast
0:     data = atmorep_sample.data[level_idx, 0]
0: pyenv/lib/python3.10/site-packages/zarr/core.py:797: in __getitem__
0:     result = self.get_basic_selection(pure_selection, fields=fields)
0: pyenv/lib/python3.10/site-packages/zarr/core.py:923: in get_basic_selection
0:     return self._get_basic_selection_nd(selection=selection, out=out, fields=fields)
0: pyenv/lib/python3.10/site-packages/zarr/core.py:963: in _get_basic_selection_nd
0:     indexer = BasicIndexer(selection, self)
0: pyenv/lib/python3.10/site-packages/zarr/indexing.py:336: in __init__
0:     dim_indexer = IntDimIndexer(dim_sel, dim_len, dim_chunk_len)
0: pyenv/lib/python3.10/site-packages/zarr/indexing.py:150: in __init__
0:     dim_sel = normalize_integer_selection(dim_sel, dim_len)
0: _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
0: 
0: dim_sel = 1, dim_len = 1
0: 
0:     def normalize_integer_selection(dim_sel, dim_len):
0:         # normalize type to int
0:         dim_sel = int(dim_sel)
0:     
0:         # handle wraparound
0:         if dim_sel < 0:
0:             dim_sel = dim_len + dim_sel
0:     
0:         # handle out of bounds
0:         if dim_sel >= dim_len or dim_sel < 0:
0: >           raise BoundsCheckError(dim_len)
0: E           zarr.errors.BoundsCheckError: index out of bounds for dimension with length 1
0: 
0: pyenv/lib/python3.10/site-packages/zarr/indexing.py:125: BoundsCheckError
0: =========================== short test summary info ============================
0: FAILED atmorep/tests/validation_test.py::test_rmse - zarr.errors.BoundsCheckE...
0: !!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
0: ========================= 1 failed, 2 passed in 1.27s ==========================
0: ============================= test session starts ==============================
0: platform linux -- Python 3.10.10, pytest-8.3.4, pluggy-1.5.0
0: rootdir: /work/ab1412
0: collected 3 items
0: 
0: atmorep/tests/validation_test.py Sample 0, Level 96: Timestamp 2021-11-27 18:00:00, Shape (54, 108)
0: Sample 75, Level 96: Timestamp 2021-01-02 15:00:00, Shape (54, 108)
0: Sample 102, Level 96: Timestamp 2021-10-22 04:00:00, Shape (54, 108)
0: Sample 68, Level 96: Timestamp 2021-07-25 21:00:00, Shape (54, 108)
0: Sample 31, Level 96: Timestamp 2021-12-27 10:00:00, Shape (54, 108)
0: .Field: t2m, levels: [0], level: 0, level_idx: 0, samples: [100, 97, 123, 50, 9, 103, 42, 75, 125, 126, 25, 69, 68, 81, 38, 95, 106, 2, 44, 88, 107, 26, 122, 49, 22, 120, 31, 10, 24, 34, 55, 18, 3, 115, 113, 84, 52, 17, 105, 67, 39, 30, 118, 41, 108, 83, 60, 124, 56, 94]
0: .F
0: 
0: =================================== FAILURES ===================================
0: __________________________________ test_rmse ___________________________________
0: 
0: field = 't2m', model_id = 'ucz8xe7v', BERT = False, epoch = 0
0: 
0:     def test_rmse(field, model_id, BERT, epoch = 0):
0:         """
0:         Test that for each field the RMSE does not exceed a certain value.
0:         50 random samples.
0:         """
0:         store_t = zarr.ZipStore(atmorep_target().format(model_id, model_id, str(epoch).zfill(5)))
0:         target = zarr.group(store_t)
0:     
0:         store_p = zarr.ZipStore(atmorep_pred().format(model_id, model_id, str(epoch).zfill(5)))
0:         pred = zarr.group(store_p)
0:     
0:         nsamples = min(len(target[field]), 50)
0:         samples = rnd.sample(range(len(target[field])), nsamples)
0:         levels = [int(f.split("=")[1]) for f in target[f"{field}/sample=00000"]] if BERT else target[f"{field}/sample=00000"].ml[:]
0:     
0:         get_data = get_BERT if BERT else get_forecast
0:     
0:         for level in levels:
0:             level_idx = level if BERT else np.where(levels == level)[0].tolist()[0]
0:             for s in samples:
0: >               sample_target, _, _, _ = get_data(target,field, s, level_idx)
0: 
0: atmorep/tests/validation_test.py:208: 
0: _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
0: atmorep/tests/test_utils.py:37: in get_forecast
0:     data = atmorep_sample.data[level_idx, 0]
0: pyenv/lib/python3.10/site-packages/zarr/core.py:797: in __getitem__
0:     result = self.get_basic_selection(pure_selection, fields=fields)
0: pyenv/lib/python3.10/site-packages/zarr/core.py:923: in get_basic_selection
0:     return self._get_basic_selection_nd(selection=selection, out=out, fields=fields)
0: pyenv/lib/python3.10/site-packages/zarr/core.py:963: in _get_basic_selection_nd
0:     indexer = BasicIndexer(selection, self)
0: pyenv/lib/python3.10/site-packages/zarr/indexing.py:336: in __init__
0:     dim_indexer = IntDimIndexer(dim_sel, dim_len, dim_chunk_len)
0: pyenv/lib/python3.10/site-packages/zarr/indexing.py:150: in __init__
0:     dim_sel = normalize_integer_selection(dim_sel, dim_len)
0: _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
0: 
0: dim_sel = 1, dim_len = 1
0: 
0:     def normalize_integer_selection(dim_sel, dim_len):
0:         # normalize type to int
0:         dim_sel = int(dim_sel)
0:     
0:         # handle wraparound
0:         if dim_sel < 0:
0:             dim_sel = dim_len + dim_sel
0:     
0:         # handle out of bounds
0:         if dim_sel >= dim_len or dim_sel < 0:
0: >           raise BoundsCheckError(dim_len)
0: E           zarr.errors.BoundsCheckError: index out of bounds for dimension with length 1
0: 
0: pyenv/lib/python3.10/site-packages/zarr/indexing.py:125: BoundsCheckError
0: =========================== short test summary info ============================
0: FAILED atmorep/tests/validation_test.py::test_rmse - zarr.errors.BoundsCheckE...
0: !!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
0: ========================= 1 failed, 2 passed in 1.04s ==========================
0: time 392.1513328552246
0: [1;34mwandb[0m:
0: [1;34mwandb[0m: You can sync this run to the cloud by running:
0: [1;34mwandb[0m: [1mwandb sync /work/ab1412/atmorep/wandb/offline-run-20250728_153002-ucz8xe7v[0m
0: [1;34mwandb[0m: Find logs at: [1;35mwandb/offline-run-20250728_153002-ucz8xe7v/logs[0m
0: l50157:2415095:2415610 [0] NCCL INFO [Service thread] Connection closed by localRank 0
0: l50157:2415095:2416227 [0] NCCL INFO comm 0x55555f102090 rank 0 nranks 1 cudaDev 0 busId 3000 - Abort COMPLETE
